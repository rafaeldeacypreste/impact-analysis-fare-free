---
titulo: "Análise de Impacto do Programa de Tarifa Zero"
subtitulo: "sobre o Imposto sobre Serviços"
aluno: "Rafael de Acypreste Monteiro Rocha"
orientador: "Thais Carvalho Valadares Rodrigues"
coorientador: ""
ano: 2024
keep-tex: true
pre-texto: "Trabalho de conclusão de curso submetido ao Departamento de Estatística da Universidade de Brasília como requisito parcial para a obtenção do grau de Bacharel em Estatística."
bibliography: bibliography-ci.bib
link-citations: true
csl: associacao-brasileira-de-normas-tecnicas-ipea.csl
format:
  pdf:
    latex_engine: xelatex
    cite-method: citeproc
    template: monografia_template-pt.tex
    fig-pos: 'H'
crossref:
  fig-prefix: Figura   # (default is "Figure")
  tbl-prefix: Tabela 
  fig-title: Figura
  tbl-title: Tabela
  sec-prefix: Seção 
lang: en
execute: 
  echo: false
  warning: false
editor_options: 
  chunk_output_type: console
---

# Introdução


“Tarifa Zero no Transporte Público” (TZ) é um modelo de financiamento no qual o custo do transporte público (TP) é coberto por impostos ou outras fontes, em vez de ser cobrado dos passageiros por meio de tarifas. Várias cidades e modelos de transporte público total ou parcialmente subsidiado estão presentes nos Estados Unidos, na Europa, na Austrália e na China [@keblowski_why_2020]. Em abril de 2024, 106 dos 5.570 municípios do Brasil^[A República Federativa do Brasil está estruturada como uma união de 26 entidades subnacionais distintas e suas respectivas subdivisões em municípios, ao lado de um Distrito Federal singular que engloba de forma única as funções de uma unidade federativa e de um município. Essa complexa organização política garante que cada componente - seja a União, as unidades federativas (Estados), as entidades subnacionais (municípios) ou o Distrito Federal - exerça tanto a autoridade executiva quanto a legislativa. No entanto, o Poder Judiciário é reservado exclusivamente à União Federal, às unidades federativas individuais e ao Distrito Federal, delineando uma clara separação de poderes dentro da estrutura de governança da nação.] tinham adotado tal política [@Santini-FFPT-2024]. Portanto, uma análise do impacto do FFPT no transporte público ajuda a entender os efeitos da política na saúde fiscal do município.


Em geral, o objetivo principal dessa política é aumentar a utilização do transporte público, o que beneficia os mais pobres, especificamente aqueles que têm mobilidade limitada [@cats_prospects_2017, p. 1095]. Essa política também pode reduzir o uso de carros particulares [@Brown_2003] e, consequentemente, os congestionamentos, a poluição e as emissões de gases de efeito estufa seriam reduzidos, embora alguns argumentem que a maior parte dos novos usuários será de pedestres e ciclistas, em vez de motoristas [@cats_prospects_2017, p. 1095; @straub_2020; @BULL-RCT-2021]. Se esse for o caso, a segurança no trânsito seria a principal externalidade positiva [@keblowski_why_2020, p. 2816]. 


Uma vez que os usuários de transporte público não usam carros diariamente, eles oferecem um serviço para os motoristas - como menos congestionamento de tráfego - e devem gastar menos ou nada com esse transporte [@keblowski_why_2020, p. 2816; @Costa_Gonçalves_Santini_2023, p. 113]. Além disso, o transporte público serve como um instrumento de inclusão social, pois permite que as pessoas tenham acesso a empregos, educação e serviços de saúde que, de outra forma, seriam inacessíveis. Porém, a recente redução no uso do transporte público vem acompanhada de um menor financiamento da política de transporte por meio da cobrança de tarifas - um fenômeno que ocorre não apenas no Brasil [@Costa_Gonçalves_Santini_2023; @straub_2020], o que exige alternativas de políticas.



Os custos associados à política levantam dúvidas e receios entre os formuladores de políticas, que se preocupam com sua sustentabilidade financeira e com o aumento da demanda por transporte público. Tarifa Zero significa que o transporte público pode ser usado sem bilhete porque o sistema é totalmente subsidiado. Alguns engenheiros de transporte e economistas estão preocupados com o risco de externalidades de aglomeração [@BULL-RCT-2021] e de viagens “inúteis” [@keblowski_why_2020, p. 2807-14] feitas somente pelo fato de serem gratuitas. Em uma linha de raciocínio contrária, alguns pesquisadores sugerem que o TZ libera a parte do orçamento familiar alocada para o transporte, permitindo que ela seja usada para outras atividades econômicas locais. Isso, por sua vez, impulsiona a economia do município e a arrecadação de impostos. 


Nesse contexto, o estudo examina a variabilidade do Imposto sobre Serviços --- conhecido como “Imposto Sobre Serviços de Qualquer Natureza” (ISS ou ISSQN) --- como a variável de resposta influenciada pela adoção da política de Tarifa Zero. O ISS foi instituído pela Lei Complementar Federal nº 116, de 31 de julho de 2003, sendo seu fato gerador a prestação de serviços delineados nos anexos da lei^[Os anexos listam 40 atividades sujeitas ao ISS, incluindo serviços de saúde, educação e tecnologia da informação]. No Brasil, os municípios têm a competência para cobrar esse imposto, que constitui uma parcela significativa de suas receitas fiscais.



Portanto, o objetivo principal desta pesquisa é avaliar o impacto da política de Tarifa Zero sobre as circunstâncias fiscais do Município. Especificamente, o estudo visa avaliar a sustentabilidade fiscal de médio e longo prazo, bem como as considerações de direitos civis, da implementação dessa política. A presente investigação diz respeito à determinação de efeitos causais, em que as metodologias estatísticas e econômicas tradicionais, como análise de custo-benefício, séries temporais convencionais, modelos econométricos e estudos de caso, mostram-se insuficientes. Embora as primeiras três metodologias possam facilitar a identificação de correlações e possíveis previsões de tendências futuras, eles não conseguem estabelecer a causalidade devido aos possíveis vieses e imprecisões introduzidos durante a seleção de variáveis [@Cinelli-2024]. Por outro lado, os estudos de caso oferecem percepções sobre os fundamentos contextuais e as motivações por trás da implementação de políticas, mas não fornecem um mecanismo robusto para avaliar as consequências econômicas dessas políticas. Consequentemente, para atingir esse objetivo, é usada uma estrutura de inferência causal. Foram avaliados os municípios que adotaram a política de TZ entre 2003 e 2019^[O número de cidades incluídas no estudo de caso pode aumentar dependendo da adoção da política e da disponibilidade de dados. Notavelmente, o perfil político do governo no momento da adoção parece não ter influência sobre a decisão de implementar um sistema de tarifa livre [@keblowski_why_2020]].


Assim, o impacto do TZ na receita tributária é estimado usando o método de diferenças-em-diferenças (DD) como uma ponte para afirmações de inferência causal. Essa é uma abordagem quase-experimental que atenua as restrições em estudos observacionais quando um estudo controlado aleatorizado (RCT, na sigla em inglês) não é viável. Ela facilita a estimativa do efeito causal de uma política ao contrastar as experiências do grupo de tratamento com um grupo de controle, tanto antes quanto depois da implementação da política. Desde que as suposições do modelo sejam verdadeiras (ver @sec-literature-review e @sec-po), não há vieses de seleção, o que permite uma estimativa precisa do efeito causal. A técnica DD funciona calculando as diferenças dentro do grupo antes e depois da intervenção e, em seguida, determinando a diferença entre esses dois valores. Daí surge o termo “diferenças-em-diferenças”.




Com suas hipóteses mantidas, o modelo DD torna-se identificável, permitindo a estimativa do efeito médio do tratamento sobre os tratados, mesmo em cenários em que os RCTs são impraticáveis. Os resultados dessa avaliação poderiam informar o discurso sobre políticas públicas, especialmente no âmbito dos sistemas de transporte público local, que sofrem com condições precárias e altos custos. Para atingir esse objetivo, são necessárias as seguintes tarefas: i) organizar o banco de dados de variáveis relacionadas às políticas de transporte; ii) identificar o modelo causal mais adequado para avaliar as implicações da política de Tarifa Zero na receita tributária municipal; iii) comparar os municípios que adotaram a política de Tarifa Zero, estabelecendo municípios que possam servir de contrafactual; e iv) investigar os benefícios econômicos indiretos, como o aumento da atividade econômica, que pode impactar positivamente a saúde fiscal geral do município.

Na @sec-literature-review, é empregada uma revisão da literatura sobre experiências mundiais de TZ e métodos DD como fonte de interpretação causal. Na @sec-po, o método diferenças-em-diferenças é detalhado e a coleta de dados é explicada. Materiais e métodos são apresentados no @sec-materials-methods. A @sec-results apresenta os principais resultados, testa as suposições do modelo e implementa algumas análises de sensibilidade. Algumas discussões e conclusões estão na @sec-disc-conclusions.  



\newpage




# Revisão de Literatura {#sec-literature-review}


A interseção entre as iniciativas de transporte público gratuito e a geração de receita do estado ainda demanda um estudo mais detalhado no Brasil. Uma investigação causal é de particular interesse nesse contexto. A literatura existente oferece uma base de estruturas teóricas e metodológicas que poderiam facilitar essa análise.



## Política de Tarifa Zero {#sec-fftp-policy}


A evolução dos sistemas de transporte urbano em direção a um modelo centrado no uso de veículos particulares acarreta um uso significativo do solo e exige um investimento público substancial na manutenção da infraestrutura. A transição para um modelo mais sustentável, racional e de baixo carbono apresenta desafios, pois exige a alteração de comportamentos de usuários e estruturas regulatórias arraigados [@Gonçalves_Santini_2023; @straub_2020]. Notavelmente, o transporte público gratuito para grupos demográficos específicos, como idosos ou estudantes, geralmente recebe a aprovação do público [@Brown_2003].

Por outro lado, a infraestrutura atual está mal equipada para suportar essa mudança [@Gabaldon_ffpt_2019]. Nesse sentido, qualquer política geral que vise a aumentar a utilização do transporte público deve levar em conta o possível aumento dos custos operacionais, incluindo mão de obra, capacidade dos veículos e gastos com combustíveis [@Gabaldon_ffpt_2019]. Esses problemas tendem a ser exacerbados durante os horários de pico de viagem^[Embora nem sempre seja o caso, conforme afirmado por @BULL-RCT-2021]. Consequentemente, a implementação de tais políticas deve ser sincronizada com melhorias na infraestrutura para suportar o aumento da demanda [@straub_2020].

Em contrapartida, a implementação da TZ pode agilizar as interações sociais e revigorar as atividades econômicas [@Gabaldon_ffpt_2019]. Essa política pode, também, neutralizar a tendência de diminuição do uso do transporte público, conforme evidenciado por vários estudos, como @Gabaldon_ffpt_2019, @Gonçalves_Santini_2023, @Brown_2003 e @straub_2020. Além disso, as barreiras de transporte exacerbam desproporcionalmente as condições de emprego para grupos economicamente marginalizados. Notadamente, foi demonstrado que os subsídios ao transporte público facilitam os comportamentos de busca de emprego. Isso aumenta, potencialmente, o engajamento no mercado de trabalho, embora as evidências que sustentam essa última afirmação não sejam robustas^[As evidências sobre isso permanecem inconclusivas, como demonstrado pelo estudo de caso de Tallinn, Estonia, avaliado por @cats_prospects_2017.], como reportado por @PHILLIPS2014. Esse efeito é particularmente acentuado em áreas com oportunidades limitadas de emprego local, o que exige grandes deslocamentos para os centros de emprego.

As tarifas de transporte público impõem um ônus financeiro significativo sobre a renda da classe trabalhadora [@Gabaldon_ffpt_2019]. Consequentemente, espera-se que a abolição dessas tarifas permita que esses indivíduos realoquem seus gastos em uma gama mais ampla de serviços e bens. Além disso, a atratividade da TZ pode catalisar um influxo de novos residentes, aumentando potencialmente as receitas fiscais locais. Para os menos favorecidos economicamente, o subsídio ao transporte público pode funcionar inadvertidamente como um mecanismo de redistribuição, beneficiando desproporcionalmente aqueles com mobilidade limitada [@keblowski_why_2020; @Costa_Gonçalves_Santini_2023]. 

A eficácia desses benefícios é mais acentuada entre os usuários sensíveis aos altos custos de transporte, que utilizam regularmente os serviços públicos. Por outro lado, os usuários com menor sensibilidade aos custos podem perceber uma diminuição nas barreiras ao transporte [@Gabaldon_ffpt_2019]. Essa dinâmica é fundamental para a transição modal de veículos particulares [@Brown_2003; @cats_prospects_2017] para o transporte público, um canal essencial para alcançar a sustentabilidade ambiental. Investigações prolongadas sobre a mudança do uso do automóvel para o transporte público poderiam esclarecer esse fenômeno^[Conforme indicado por @BULL-RCT-2021, os resultados iniciais provavelmente representam uma estimativa conservadora da transição modal, com a expectativa de que a adoção do transporte público aumente progressivamente]. 



Além disso, os sistemas de Tarifa Zero geralmente operam dentro das fronteiras urbanas, exercendo uma atração sobre os padrões de migração [@cats_prospects_2017]. Uma análise empírica recente feita por @BULL-RCT-2021 observou um aumento acentuado nas viagens fora do horário de pico após a implementação do TZ, principalmente para atividades de lazer. Isso sugere que as políticas de TZ podem ser mais eficazes na criação de novas viagens do que na alteração dos modos de viagem dos usuários atuais. Essas considerações também são imperativas quando o resultado pretendido é a redução das emissões de combustíveis fósseis. Dito tudo isso, é importante medir o impacto da adoção de uma política de TZ sobre a saúde fiscal do governo local.




## Inferência Causal por meio de Estudos Observacionais 


Os efeitos causais são fundamentais para a avaliação do impacto de qualquer política pública [@batista_domingos_2017]. Uma política é desenvolvida e aplicada para atingir objetivos específicos. Após sua implementação, formuladores(as) de políticas devem analisá-la para confirmar seus efeitos, principalmente se as metas originais foram atingidas ou se surgiram externalidades inesperadas. Assim, a principal questão causal é o contrafactual: o que teria acontecido se a política não tivesse sido implementada? A resposta a essa questão é o efeito causal da política, que, no entanto, não pode ser observado diretamente. Como resultado, as abordagens usadas para avaliar os efeitos causais buscam recuperar essa variável não observável. 

O padrão ouro para medir o efeito causal de uma política é o estudo controlado aleatorizado (ou randomizado). Quando aplicado, um RCT garante que o tratamento seja atribuído aleatoriamente às unidades. Portanto, os grupos tratados e não tratados (controle) diferem apenas pelo tratamento, e seu efeito pode ser avaliado. Dessa forma, o grupo de controle atua como um contrafactual. Entretanto, a randomização é rara em políticas públicas, mesmo que seja viável. Às vezes, a política já foi implementada e só é possível acessar dados observacionais. Na maioria dos casos, o RCT não é possível devido a questões políticas, éticas ou de custo. A Tarifa Zero é um desses casos: como não há um plano nacional de transporte, a adoção da política é uma opção da administração local, em que vários fatores desconhecidos são importantes.

Para lidar com essas questões causais, são usados projetos quase-experimentais, como diferenças nas diferenças, \textit{matching} ou controle sintético [@batista_domingos_2017; @mostly_harmless_econometrics]. Os projetos quase-experimentais visam a “isolar” o efeito causal dos fatores de confusão e do viés de seleção \textit{strictu sensu} [@batista_domingos_2017]. Os fatores de confusão são variáveis que afetam tanto o tratamento quanto as variáveis de resultado [@pearl2018]. Sem levar em conta simultaneamente os fatores de confusão, é impossível determinar uma relação causal entre as variáveis, pois a medida também pode ser influenciada por essas variáveis. A confusão é amplamente considerada como o principal desafio na inferência causal e é a inspiração por trás do ditado “correlação não implica causalidade” [@Hernan2020, p. 83]. O aumento do crescimento positivo do PIB de um município tem um impacto significativo na arrecadação de impostos e promove a construção de FFPT, por exemplo. A estimativa dos efeitos causais está sujeita a vieses se não for ajustada matematicamente. Os estudos controlados e randomizados podem mitigar os efeitos de confusão por meio do próprio desenho da pesquisa, enquanto os estudos observacionais normalmente estimam os efeitos causais controlando as variáveis de confusão.  


Nesse sentido, a questão de por que um município adotou o transporte público gratuito demanda atenção, pois o processo de seleção não é aleatório. Por exemplo, durante a pandemia da COVID-19, vários municípios testemunharam empresas privadas abandonando suas concessões de transporte público. Para preencher o vazio, alguns municípios assumiram o serviço e o forneceram gratuitamente. Isso levou a um viés na seleção dos sujeitos em análise, pois a falência das empresas privadas influenciou a adoção da TZ. Consequentemente, o grupo tratado pode não ser representativo da população, e algum controle estatístico deve ser empregado antes de generalizar as conclusões [@PearlMackenzie18, cap. 5].

Há também o viés de seleção \textit{strictu sensu} ocorre quando os efeitos comuns do tratamento e da variável de resultado são levados em conta [@Hernan2020, p. 99]. Esse tipo de viés pode surgir quando os indivíduos se voluntariam para participar de um estudo não aleatorizado. No caso da TZ, o viés de seleção pode ser introduzido pelo condicionamento do nível de emprego ou de salários, já que a política de isenção de tarifas tende a aumentar o emprego e os salários [@piazza_avaliacao_2017]. Além disso, o aumento da arrecadação de impostos por meio da Tarifa Zero pode melhorar as aquisições de serviços estatais, levando a níveis mais altos de emprego. É também uma suposição crucial que os RCTs abordam, embora o viés de seleção ainda possa ocorrer nesses estudos quando algumas unidades deixam o estudo, ou seja, quando há censura no estudo.


Embora existam distinções entre confusão e viés de seleção \textit{strictu sensu}, econometristas e estatísticos(as) geralmente se referem a eles genericamente como “viés de seleção”. Isso ocorre porque ambos os tipos de viés estão relacionados ao processo de seleção, seja a seleção de indivíduos com dados observados em análise (viés de seleção \textit{strictu sensu}) ou a seleção de indivíduos sujeitos ao tratamento (confusão), conforme afirmado por @Hernan2020[p. 103]. No caso do FFTP, em que a adoção de políticas é discricionária e os dados abrangem todos os municípios, a principal preocupação é a confusão. Consequentemente, na @sec-po, viés de seleção e confusão são usados de forma intercambiável quando não há risco de mistura de conceitos.

Juntamente com esses dois alertas, a estrutura do possível efeito da TZ sobre a arrecadação de impostos exige duas comparações. Para começar, é importante considerar como a política afeta a situação fiscal em municípios com e sem transporte público gratuito. Além disso, talvez seja interessante examinar como a política afeta a situação fiscal nos municípios antes e depois da adoção. A primeira análise compara os dados de diferentes seções, enquanto a segunda examina os dados ao longo do tempo. 

Entretanto, nenhuma delas fornece automaticamente um contrafactual exato [@batista_domingos_2017]. A estimativa contrafactual é necessária quando não há viés de seleção. Na análise de seção transversal, o viés de seleção pode ser causado pela influência dos motivos para a adoção do TZ por um município na variável de resultado. Por outro lado, ele também pode afetar a análise de séries temporais, uma vez que as variáveis variáveis temporais simultâneas também podem influenciar o resultado de interesse. 


A abordagem de diferença em diferenças neutraliza efetivamente as diferenças constantes entre os grupos, incluindo fatores não observáveis, por \textit{design}. Entretanto, outras fontes de viés de seleção podem surgir, dependendo das especificidades do caso. O modelo exige a adesão ao pressuposto de tendências paralelas, que pressupõe que, na ausência de tratamento, a trajetória do grupo tratado espelharia a do grupo não tratado. Embora isso não possa ser verificado diretamente, os métodos indiretos podem oferecer estimativas razoáveis. Além disso, duas outras suposições são fundamentais: primeiro, a ausência de antecipação do tratamento, garantindo que os indivíduos não alterem seu comportamento antes da intervenção real; e segundo, a suposição de valor de tratamento de unidade estável (SUTVA), que pressupõe que o tratamento de uma unidade não influencia os resultados potenciais de outra. Essas premissas são elaboradas posteriormente na @sec-did.


## Arcabouço de Resultados Potenciais {#sec-po}



A avaliação do impacto causal de uma variável de tratamento em uma variável de resultado envolve a comparação do efeito observado quando o tratamento é administrado com o cenário hipotético em que o tratamento não foi aplicado, conhecido como contrafactual. Entretanto, esse contrafactual é inerentemente não observável. Por exemplo, não é viável que a TZ seja implementada e não implementada simultaneamente em um determinado município. 

O ponto crucial do debate, portanto, está na identificação de uma unidade (ou unidades) comparável(is) que possa(m) representar efetivamente o contrafactual. Na estrutura de um estudo controlado randomizado, o contrafactual é incorporado pelo grupo de controle, que é selecionado por meio de aleatorização [@mostly_harmless_econometrics, p. 15; @Hernan2020]. Esse método é considerado o padrão ouro, pois gera um alto nível de confiança de que quaisquer diferenças observadas nos resultados entre os grupos de tratamento e controle são atribuíveis exclusivamente ao tratamento. Nos casos em que a randomização é impraticável, metodologias estatísticas alternativas devem ser empregadas para a avaliação do impacto.


Antes de explorar essas metodologias alternativas, é essencial estabelecer uma estrutura matemática para a inferência causal. Utilizando a notação para resultados potenciais^[@pearl2018 aplica algumas notações distintas e arquitetura de inferência causal, mesmo com muito em comum com “resultados potenciais”, usados principalmente em Economia.] [@roth_whats_2023, p. 2221], vamos denotar $Y_{i,t}(0, 0)$ como o resultado de interesse para uma unidade que não recebeu o tratamento durante dois períodos distintos, em que $i$ representa a unidade em estudo e $t \in \{1,2\}$ significa o período. Por outro lado, $Y_{i,t}(0, 1)$ representa o resultado de uma unidade que não recebeu tratamento no primeiro período ($t = 1$), mas recebeu tratamento no período subsequente. Por uma questão de simplicidade, a notação dos resultados potenciais será simplificada para $Y_{i,t}(0) \equiv Y_{i,t}(0, 0)$ e $Y_{i,t}(1) \equiv Y_{i,t}(0, 1)$^[É importante observar que, nessa estrutura inicial, os grupos que sempre receberam tratamento ($Y_{i,t}(1, 1)$) e aqueles que foram tratados anteriormente, mas não estão mais recebendo tratamento ($Y_{i,t}(1, 0)$) não são considerados. Na prática, se os efeitos do tratamento forem consistentes ao longo do tempo, os grupos que são sempre tratados podem servir como controle]. Nos casos em que o tratamento é dicotômico, o resultado resultante é delineado pela seguinte equação:
\begin{equation} \label{eq-outcome-variable}
Y_{i,t} = D_{i,t} \cdot Y_{i,t}(1) + (1 - D_{i,t}) \cdot Y_{i,t}(0).
\end{equation}
Aqui, $D_{i,t} = 1$ significa o tratamento administrado durante o período $t$, com a observação de apenas um resultado em potencial^[É imperativo observar que se presume que a variável causadora precede temporariamente o resultado, portanto, o período simultâneo $t$ para as variáveis de tratamento e resultado sugere o início do tratamento e a culminação do resultado no mesmo período, um conceito viável devido à sequência temporal discreta].

A principal preocupação é calcular o efeito médio do tratamento nos indivíduos que o receberam. A equação fundamental para estimar o efeito médio do tratamento sobre os tratados ($\tau_2$ ou ATT, como comum na sigla em inglês) para o período $t=2$ é expressa como:
\begin{equation} 
\label{eq-counterfactual}
   \tau_2 = \mathbb{E}[Y_{i,2}(1) - Y_{i,2}(0) | D_{i,2} = 1].
\end{equation}
Nesse contexto, {$Y_{i,2}(0) | D_{i,2} = 1$} simboliza o cenário contrafatual para a coorte tratada no segundo período, supondo a ausência de tratamento, que permanece inerentemente não observável.


Portanto, \eqref{eq-counterfactual} pode ser reescrita para encontrar --- $\{Y_{i,2}(0) | D_{i,2} = 0\}$ é o candidato natural --- um candidato a atuar como um contrafactual: 
\begin{equation*} 
\tau_2 = \mathbb{E}[Y_{i,2}(1)| D_{i,2} = 1] - \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 1] + \overbrace{\mathbb{E}[Y_{i,2}(0) | D_{i,2} = 0] - \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 0]}^{= 0},
\end{equation*} que pode ser rearranjado para:
\begin{equation} 
      \tau_2 = \mathbb{E}[Y_{i,2}(1)| D_{i,2} = 1] - \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 0] + \underbrace{\mathbb{E}[Y_{i,2}(0) | D_{i,2} = 0] - \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 1]}_{\text{viés de seleção}}.
\end{equation} 
O último termo do lado direito representa o viés de seleção não quantificável. Fundamentalmente, isso implica que, se os resultados potenciais para as coortes tratadas e não tratadas forem idênticos, ou seja, $\mathbb{E}[Y_{i,2}(0) | D_{i,2} = 1] = \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 0]$, então a coorte não tratada, doravante denominada grupo de controle, é postulada para adotar a posição contrafactual. Consequentemente, a diferença média entre os resultados observados é indicativa do efeito causal do tratamento sobre os tratados, denotado como $\tau_2$. A proposta aqui é adotar a metodologia Diferenças-em-diferenças para calcular esse valor, desde que seus pressupostos sejam atendidos.









## Diferenças-em-diferenças {#sec-did}




A metodologia de Diferenças-em-diferenças (DD) serve como um projeto quase-experimental para estimar o impacto causal médio do tratamento em um grupo tratado em relação a um grupo de controle. Esse projeto é aplicável quando o tratamento é administrado simultaneamente ou em intervalos de tempo variáveis [@cunningham_causal_2024, cap. 9; @roth_whats_2023]. Seu principal objetivo é verificar o efeito causal na ausência de um estudo controlado randomizado, especialmente quando a alocação do tratamento é não aleatória ou endógena, de acordo com a terminologia usada em Economia [@bladimir_carrillo_bermudez_o_2024, p. 330]. Sem aleatorização, pode haver diferenças pré-existentes entre os grupos tratados e de controle que influenciam o resultado de interesse, que o modelo DD procura abordar.

De forma concisa, essa abordagem envolve o cálculo das diferenças pré e pós-tratamento em cada grupo, seguido das diferenças intergrupos. Para atenuar o viés de variável omitida (OVB, na sigla em inglês) decorrente de fatores de confusão ou outras formas de viés de seleção, são empregadas técnicas de regressão múltipla, conforme descrito na @sec-did-covariates. Quando o OVB é efetivamente controlado por meio de um conjunto abrangente de covariáveis, o estimador DD se torna não viesado e consistente, facilitando assim a estimativa precisa do efeito causal.

Pré-requisitos adicionais devem ser satisfeitos para a validade da abordagem de diferença-em-diferença, principalmente a suposição de “tendências paralelas”. Isso postula que, na ausência de qualquer intervenção, as trajetórias dos grupos tratados e não tratados teriam evoluído em conjunto [@roth_whats_2023, p. 2221]. Essa premissa, no entanto, não é inerentemente verificável, uma vez que se refere a um cenário hipotético sobre os resultados potenciais do grupo tratado. Além disso, a observação de tendências paralelas antes da intervenção não as estabelece como condição necessária ou suficiente para o paralelismo pós-intervenção. Formalmente, a expressão em nível populacional da suposição de tendências paralelas é encapsulada na Equação \eqref{eq-parallel-trend}:
\begin{equation}
\label{eq-parallel-trend}
   \mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 1] = \mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 0].
\end{equation}

A presunção de tendências paralelas está implicitamente incorporada na estrutura da análise de regressão linear, especificamente no estimador de mínimos quadrados ordinários (MQO). Isso ocorre porque o estimador MQO adota intrinsecamente a trajetória do grupo de controle como um substituto para o cenário contrafactual do grupo tratado [@cunningham_causal_2024, cap. 9.2.3]. Se essa suposição se mostrar insustentável, as estimativas do modelo resultante serão consideradas imprecisas. Essencialmente, isso requer a presença de um grupo de controle que espelhe de perto a trajetória que o grupo tratado teria seguido na ausência de qualquer intervenção^[Existe uma variante menos rigorosa dessa suposição para tratamentos variáveis no tempo, denominada “tendências comuns ponderadas pela variância”, que permite a anulação de tendências divergentes por meio da ponderação [@cunningham_causal_2024, cap. 9.6.4].]. No entanto, isso também não pode ser verificado empiricamente. Um método indireto para avaliar a plausibilidade dessa suposição envolve o exame das tendências pré-tratamento em ambas as coortes [@bladimir_carrillo_bermudez_o_2024, p. 336].

Na metodologia convencional de diferenças-em-diferenças, as variáveis que poderiam introduzir um viés de seleção, mas que permanecem constantes ao longo do tempo, são naturalmente neutralizadas. Essa atenuação ocorre porque a metodologia controla inerentemente esses efeitos fixos calculando o diferencial da variável observada para a mesma unidade em dois períodos de tempo distintos. Consequentemente, a abordagem DD neutraliza de fato a influência de variáveis de confusão invariantes no tempo [@cunningham_causal_2024, cap. 9.2.2]. Por exemplo, no cenário de TZ, quaisquer fatores geográficos ou legislativos que permaneçam constantes ao longo do tempo e que possam afetar a adoção de uma política são efetivamente controlados no processo de estimativa, independentemente de sua medição direta.

Entretanto, esse equilíbrio pode ser perturbado por certos elementos, conforme observado por @roth_whats_2023[p. 2229]. Especificamente, os fatores de confusão que flutuam ao longo do tempo representam um desafio significativo se estiverem correlacionados com as condições econômicas regionais que podem afetar a implementação de políticas de Tarifa Zero. Além disso, a forma funcional usada na aplicação do MQO pode alterar a estabilidade presumida das tendências. Por exemplo, o método de quantificação da receita tributária pode infringir essa premissa, enquanto a utilização do valor logarítmico da receita tributária pode não infringir, e o inverso também pode ser verdadeiro. A estratégia predominante para tratar dessa preocupação envolve o ajuste de um vetor de covariáveis, $\boldsymbol{X_i}$, para simular a atribuição aleatória do tratamento [@roth_whats_2023, p. 2229], que é detalhada na @sec-did-covariates.

Dada a natureza fundamental da hipótese de tendência paralela, @roth_whats_2023[p. 2236] defendem uma análise de sensibilidade para avaliar o impacto de quaisquer desvios nos resultados primários. Eles empregam diagramas de “estudo de evento” para verificar a integridade dessa suposição, aplicando valores defasados variados de tratamento para contornar as implicações adversas da modelagem de “efeitos fixos bidirecionais” (TWFE, na sigla em inglês) [@roth_whats_2023, p. 2235]. Isso é feito na @sec-event-study. Uma exceção ocorre quando a intervenção influencia as covariáveis sensíveis ao tempo, tornando-as controles “ruins” [@roth_whats_2023, p. 2232]. Consequentemente, uma análise de sensibilidade é imperativa para confirmar a resiliência da estrutura DD.


Outro pressuposto é o pressuposto de valor de tratamento unitário estável (SUTVA). Esse requisito pressupõe que os resultados potenciais de uma determinada unidade não são afetados pelos tratamentos específicos aplicados a outras unidades. Isso implica uma ausência de interferência ou “externalidades” [@cunningham_causal_2024, cap. 4.1.5]. Essa suposição é bifurcada em dois componentes: primeiro, a uniformidade dos tratamentos, que, no contexto de uma iniciativa de Tarifa Zero, se traduz em uma aplicação consistente da política em todos os habitantes do município; segundo, a independência dos efeitos da política, indicando que a adoção de uma política em um município não influencia diretamente os resultados potenciais, como o PIB de outros municípios. A hipótese do SUTVA é considerada factível no contexto da presente análise por dois motivos principais. No caso do primeiro componente, a viabilidade do programa de Tarifa Zero é considerada em cenários em que ela é aplicado universalmente em toda a população. No segundo componente, a plausibilidade da suposição é apoiada pelo arranjo relativamente disperso dos municípios que implementaram a TZ, juntamente com a interdependência econômica mínima observada entre eles. 

Além disso, a identificação de efeitos causais depende de um terceiro pressuposto denominado “não antecipação” [@roth_whats_2023, p. 2222]. Isso pressupõe a ausência de modificações comportamentais antes da aplicação de um tratamento, formalmente expresso como {$Y_{i,1}(0) = Y_{i,1}(1)$} para todos os indivíduos $i$ em que $D_{i,2} = 1$. Analisando o cenário específico em questão, infere-se que os efeitos prospectivos sobre os resultados, como a receita tributária, não devem ser influenciados pela população antes da promulgação de uma política de isenção de tarifas. Consequentemente, isso parece não ser um problema no contexto da Tarifa Zero. Além disso, semelhante a vários modelos estatísticos, o processo de estimativa é baseado na amostragem de grupos independentes --- municípios --- de uma superpopulação maior [@roth_whats_2023, p. 2219].




Dadas as condições estipuladas e na ausência de viés de variável omitida, o modelo DD é identificável, conforme delineado por @roth_whats_2023[p. 2222]. A estimativa procede da suposição fundamental de tendência paralela na Equação \eqref{eq-parallel-trend}, articulada da seguinte forma:
\begin{equation}
\label{eq-counterfactual-assumptions}
\begin{split}
    \mathbb{E}[Y_{i,2}(0) | D_{i,2} = 1] = & \quad \mathbb{E}[Y_{i,1}(0) | D_{i,2} = 1] + \mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 0] \\
    \stackrel{\text{não-antecipação}}{=} & \quad \mathbb{E}[Y_{i,1}(1) | D_{i,2} = 1] + \mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 0] \\\
    \stackrel{\text{não-confundimento}}{=} & \quad \mathbb{E}[Y_{i,1} | D_{i,2} = 1] + \mathbb{E}[Y_{i,2} - Y_{i,1} | D_{i,2} = 0].
\end{split}
\end{equation}
Essa equação é baseada na manifestação média do efeito de não antecipação, em que $\mathbb{E}[Y_{i,1}(0) | D_{i,2} = 1] = \mathbb{E}[Y_{i,1}(1) | D_{i,2} = 1]$. De acordo com a suposição de ausência de variáveis confundidores, o estimador DD encapsula o diferencial da média observada --- veja a Equação \eqref{eq-outcome-variable} --- entre as coortes tratadas e de controle em ambas as fases temporais --- representados por $\mathbb{E}[Y_{i,1}|D]$ e $\mathbb{E}[Y_{i,2}|D]$. Consequentemente, a Equação \eqref{eq-counterfactual-assumptions} elucida a metodologia para estimar o contrafactual. Substituindo isso na Equação \eqref{eq-counterfactual}, obtém-se o estimador DD como:
\begin{equation} \label{eq-did-estimator}
\begin{split}
    \tau_2 & = \mathbb{E}[Y_{i,2}(1) - Y_{i,2}(0) | D_{i,2} = 1] \\
     & = \mathbb{E}[Y_{i,2} - Y_{i,1}| D_{i,2} = 1] - \mathbb{E}[Y_{i,2} - Y_{i,1} | D_{i,2} = 0].
\end{split}
\end{equation}
Isso representa o agregado das médias efetivas de diferenças-em-diferenças para a população [@roth_whats_2023]. Entretanto, essa estrutura foi projetada para levar em conta dois períodos, o que pode não ser aplicável em cenários em que o tratamento é administrado em intervalos variáveis. Isso é abordado na Seção a seguir.





### Diferenças-em-diferenças e tratamento variável no tempo {#sec-did-time-varying}



A adoção de tratamentos que variam ao longo do tempo pode ser abordada por meio da análise de diferenças-em-diferenças. No campo das ciências sociais, os projetos experimentais são menos predominantes em comparação com outros campos, o que faz com que os tratamentos sejam implementados em momentos diferentes. Consequentemente, para uma unidade que recebe tratamento em um determinado momento, existem três grupos de controle em potencial: a) unidades que nunca foram tratadas; b) unidades que já foram tratadas; e c) unidades que ainda não foram tratadas. Esse cenário foi observado na implementação do transporte público gratuito nos municípios brasileiros, uma consequência de sua estrutura federalista. Portanto, a implementação da política em cada unidade depende de suas condições políticas e fiscais específicas. 


No entanto, o modelo canônico DD $2 \times 2$ (dois períodos $\times$ dois grupos), conforme apresentado na @sec-did, não é adequado para modelos variáveis no tempo [@Goodman-Bacon-2021-DiD, p. 254-5] ao medir o efeito médio do tratamento sobre os tratados. O principal motivo é que ele considera todas as combinações possíveis de $2 \times 2$, uma das quais envolve a comparação de unidades tratadas tardiamente com unidades tratadas precocemente atuando como grupo de controle, um cenário que não é plausível. Portanto, o modelo deve ser adaptado para acomodar tratamentos variáveis no tempo.

O conceito de variação temporal é formalizado pela definição de períodos como $t = 1, 2, \dots, T$, onde o tratamento pode ser implementado a qualquer momento $t > 1$. O tempo de implementação é indexado por $G_i = \min\{t: D_{i,t} = 1\}$ [@roth_whats_2023, p. 2223]. Se o tratamento nunca for implementado, então $G_i = \infty$, que é denotado por uma variável binária, definida como uma função indicadora $C_i = \mathds{1}\{G_i = \infty\} = 1$. Na estrutura de resultados potenciais, a variável de resultado é denotada por $Y_{i, t}(\boldsymbol{0}_{g-1}, \mathds{1}_{T-g+1})$, ou simplesmente $Y_{i, t}(g)$, quando o tratamento é implementado no tempo $g$. Para uma unidade que nunca recebe tratamento, a variável de resultado é representada por $Y_{i, t}(\boldsymbol{0}_{T})$, denotada por $Y_{i, t}(\infty)$.

A intervenção que está sendo examinada é dicotômica, e consideraremos apenas municípios que exibem uma natureza irreversível, ou seja, após sua implementação, a política permanece em vigor indefinidamente. Ele constrói fundamentalmente uma estrutura em torno do efeito médio do tratamento de grupo-tempo sobre o tratado, articulado como $ATT(g, t) = \mathbb{E}[Y_{i,t}(g) - Y_{i,t}(\infty) | D_{i,t} = 1, G_i = g]$, em que $G_i$ denota a coorte à qual a unidade $i$ pertence, tendo sido administrado o tratamento começando no período $g$. Esta metodologia foi conceituada em @CALLAWAY2021200. Para ilustrar, $ATT(2014, 2016)$ significa o impacto da TZ em 2016, dependendo de sua adoção pelo município em 2014. Presumindo a suposição de tendência paralela^[Consulte @sec-did-covariates para o cenário em que tendências paralelas são válidas somente mediante condicionamento em covariáveis.] e a ausência de comportamento antecipatório, o ATT é discernido por meio da disparidade entre os resultados do grupo tratado e do grupo de controle (aqueles aguardando tratamento ou nunca tratados) durante os períodos $t$ e $g-1$ [@roth_whats_2023]:
\begin{equation*}
ATT(g, t) = \mathbb{E}[Y_{i,t} - Y_{i,g-1} | G_i = g] - \mathbb{E}[Y_{i,t} - Y_{i,g-1} | G_i = g'] \quad \text{para qualquer} \quad g' > t.
\end{equation*}
Isso pode ser estendido para abranger todos $\mathbb{G}_{comp} = \{g: g' > t\}$ conforme delineado por
\begin{equation} \label{eq-att}
ATT(g, t) = \mathbb{E}[Y_{i,t} - Y_{i,g-1} | G_i = g] - \mathbb{E}[Y_{i,t} - Y_{i,g-1} | G_i \in \mathbb{G}_{comp}].
\end{equation}
A estimativa empírica de ATT é derivada de sua contraparte de amostra [@roth_whats_2023, p. 2226]:
\begin{equation} \label{eq-att-estimator}
\widehat{ATT}(g, t) = \frac{1}{N_g} \sum_{i:G_i=g} \left[ Y_{i,t} - Y_{i,g-1} \right] - \frac{1}{N_{\mathbb{G}_{comp}}} \sum_{i:G_i \in \mathbb{G}_{comp}} \left[ Y_{i,t} - Y_{i,g-1} \right],
\end{equation}
onde $N$ representa a contagem de unidades dentro de cada amostra respectiva.


Os efeitos heterogêneos da política da TZ são revelados por meio de parâmetros causais individuais. No entanto, as inúmeras interações entre $g$ e $t$ podem complicar a interpretação do efeito médio do tratamento sobre o tratado para cada permutação. Para simplificar, a metodologia calcula uma média ponderada desses ATTs, seguindo as diretrizes de @CALLAWAY2021200 e @roth_whats_2023. Essa abordagem estima os efeitos médios para cada intervalo ($l$) após o início do tratamento, destacando os impactos variáveis ​​da política ao longo do tempo e oferecendo uma visão sobre seus resultados.

Provavelmente, o ambiente econômico e político em torno da implementação de políticas de tarifa gratuita necessita de um modelo de média para uma duração especificada pós-intervenção, articulado como:
\begin{equation}
\label{eq-att-estimator-avg}
ATT_{l}^{w} = \sum_{g} w(g) \cdot ATT(g, g + l).
\end{equation}
Aqui, $w(g)$ significa o peso atribuído ao ATT durante o intervalo $g$, que é uniformemente definido entre coortes ou de acordo com a prevalência de cada intervalo de tempo $l$ [@roth_whats_2023, p. 2227]. Alternativamente, o efeito da política pode ser calculado em média ao longo de um ano específico de implementação, revelando efeitos diversos entre diferentes coortes e fornecendo uma análise abrangente. Outras comparações menos comuns também são possíveis e podem ser aplicadas neste contexto. As agregações empregadas são apresentadas na @sec-aggregating. Na fase de inferência, técnicas de \textit{bootstrapping} são empregadas para construir intervalos de confiança para os ATTs, conforme descrito em @CALLAWAY2021200[p. 216]. Finalmente, este modelo fundamental é adaptável para a inclusão de covariáveis.






### Diferenças-em-diferenças e tendências paralelas condicionada em covariáveis ​​{#sec-did-covariates}



A variação pronunciada entre os municípios brasileiros em aspectos como área, produto interno bruto e demografia pode afetar a suposição de tendências paralelas. Essa variância tem o potencial de introduzir viés no modelo Diferenças-em-diferenças. Para mitigar esse risco, a extensão do modelo para abranger covariáveis ​​aumenta sua robustez [@roth_whats_2023, p. 2229]. Para resumir, presumimos que tendências paralelas são exibidas apenas por municípios que compartilham atributos semelhantes. A suposição de tendências paralelas, condicional a covariáveis, é encapsulada pela seguinte equação:
\begin{equation}
\label{eq-parallel-trend-cond}
\mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 1, \boldsymbol{X_i}] = \mathbb{E}[Y_{i,2}(0) - Y_{i,1}(0) | D_{i,2} = 0, \boldsymbol{X_i}] \quad (\text{quase certamente}),
\end{equation}
onde $\boldsymbol{X_i}$ representa um vetor de covariáveis ​​antes do tratamento. Este paradigma é ainda mais extrapolado para acomodar modelos com tratamentos que variam no tempo, conforme exposto por @CALLAWAY2021200.

Uma consideração crítica ao incorporar covariáveis ​​é o pré-requisito de ter municípios tratados e não tratados dentro de um conjunto de covariáveis ​​específico, ou seja, $\boldsymbol{X_i} = x, \text{ para algum } i$ em ambas as coortes. Este requisito é encapsulado na "suposição de forte sobreposição". Em um sentido formal, isso postula que para um infinitesimal $\varepsilon > 0$, a probabilidade $\varepsilon < P(D_{i,t} = 1 | X_i) < 1 - \varepsilon$ deve ser válida para cada $\boldsymbol{X}$ dentro da amostra [@roth_whats_2023, p. 2230]. Na @sec-data, uma análise parcial é mostrada. Além disso, a Equação \eqref{eq-did-estimator} passa por uma reformulação com a integração de covariáveis, delineadas como:
\begin{equation} \label{eq-did-estimator-covariates}
\begin{split}
    \tau_2 & = \mathbb{E}[Y_{i,2}(1) - Y_{i,2}(0) | D_{i,2} = 1, \boldsymbol{X_i}] \\
     & = \mathbb{E}[Y_{i,2} - Y_{i,1}| D_{i,2} = 1, \boldsymbol{X_i}] - \mathbb{E}[Y_{i,2} - Y_{i,1} | D_{i,2} = 0, \boldsymbol{X_i}].
\end{split}
\end{equation}

Após delinear a estrutura teórica e suas premissas fundamentais, a fase subsequente envolve uma análise empírica para estimativa e inferência. Dentro do domínio empírico para um modelo não paramétrico, três metodologias se destacam, conforme destacado por @CALLAWAY2021200[pp. 205-6]: estimadores de Regressão de Resultado (\textit{Outcome Regression} - OR, em inglês), Escore de Propensão Generalizado (\textit{Inverse Probability Weighting} - IPW, em inglês) e Duplamente Robusto (\textit{Doubly Robust} - DR, em inglês). O paradigma DR amalgama IPW e OR, começando com o cálculo do escore de propensão generalizado, sucedido por uma regressão de resultado. Um requisito fundamental é a especificação precisa da evolução do resultado ou do modelo de escore de propensão para as unidades nunca tratadas --- ou ainda não tratadas, ou ambas, dependendo das suposições --- [@SANTANNA2020101, p. 105].

Portanto, o modelo duplamente robusto foi selecionado para o presente estudo devido à sua resiliência a erros na especificação do modelo [@CALLAWAY2021200, p. 212]. O modelo para escores de propensão caracteriza a probabilidade de uma unidade receber tratamento dentro de um período de tempo específico, dadas as covariáveis. Ao designar as coortes nunca tratadas e ainda não tratadas como o grupo de controle^[Em @CALLAWAY2021200, cenários onde unidades ainda a serem tratadas servem como grupo de controle também são elaborados.], o modelo é operacionalizado por meio de regressão logística [@SANTANNA2020101, pp. 108-9], e a probabilidade de adoção do tratamento inicial é articulada como $p_{g,T}(\boldsymbol{X}) = P(G_g=1 | \boldsymbol{X}, G_g + C = 1)$, ou em uma forma mais condensada, $p_{g}(\boldsymbol{X})$^[A partir de agora, assume-se que o índice $i$ é implícito por uma questão de brevidade.].


A abordagem teórica da metodologia de Diferenças-em-diferenças é essencial para o exame do impacto causal da política de TZ nas receitas fiscais municipais. Do ponto de vista empírico, a integração de covariáveis ​​é consistente sob a metodologia de estimativa duplamente robusta, que é explicada em @CALLAWAY2021200. A estimativa de DR é articulada da seguinte forma:
\begin{equation}
\label{eq-dr-identification}
ATT(g, t) = \mathbb{E} \left[ \left(\frac{G_g}{\mathbb{E}[G_g]} - \dfrac{ \dfrac{p_g(\boldsymbol{X}) C}{1 - p_g(\boldsymbol{X})} }{\mathbb{E} \left[\dfrac{p_g(\boldsymbol{X}) C}{1 - p_g(\boldsymbol{X})} \right]} \right) (Y_t - Y_{g-1} - m_{g,t}(\boldsymbol{X}) ) \right].
\end{equation}
O termo $m_{g,t}(\boldsymbol{X}) = \mathbb{E}[Y_t - Y_{g-1}|\boldsymbol{X}, C = 1]$ denota a regressão do resultado esperado para a população que nunca foi ou ainda não foi tratada [@CALLAWAY2021200, p. 205; @SANTANNA2020101, p. 104].

Por todas essas razões, a estimativa do modelo DiD pode ser executada empregando um estimador robusto duplo de duas etapas --- mais uma vez, dependente da validade da suposição de tendências paralelas --- conforme proposto por @CALLAWAY2021200^[No modelo original, o parâmetro $\delta$ indica uma suposição de não antecipação menos rigorosa. No entanto, não é considerado aqui. Para uma discussão aprofundada, consulte @CALLAWAY2021200[p. 204].]. A etapa inicial envolve a estimativa dos seguintes pesos para os grupos tratado e controle, respectivamente:
\begin{equation*}
\widehat{w}_g^{treat} = \frac{G_g}{\mathbb{E}_n[G_g]}, \quad
\widehat{w}_g^{control} = \dfrac{ \dfrac{\widehat{p}_g(\boldsymbol{X}; \widehat{\pi}_g) C}{1 - \widehat{p}_g(\boldsymbol{X}; \widehat{\pi}_g)} }{\mathbb{E}_n \left[\dfrac{\widehat{p}_g(\boldsymbol{X}; \widehat{\pi}_g) C}{1 - \widehat{p}_g(\boldsymbol{X}; \widehat{\pi}_g)} \right]},
\end{equation*}
onde o operador $\mathbb{E}_n[Z] = n^{-1} \sum_{i=1}^n Z_i$ denota a média empírica de uma variável $Z$. Além disso, o termo $\widehat{p}_g(\cdot; \widehat{\pi}_g)$ representa a pontuação de propensão estimada que é derivada usando um modelo de regressão logística [@CALLAWAY2021200, p. 212]. A segunda etapa do processo de estimativa é encapsulada por:
\begin{equation}
\label{eq-dr-estimation}
\widehat{ATT}(g, t) = \mathbb{E}_n \left[ (\widehat{w}_g^{treat} - \widehat{w}_g^{control}) (Y_t - Y_{g-1} - \widehat{m}_{g,t}(\boldsymbol{X}; \widehat{\beta}_{g,t}) ) \right],
\end{equation}
onde $\widehat{m}_{g,t}(\boldsymbol{X}; \widehat{\beta}_{g,t})$ expressa a regressão do resultado, que é obtida por meio de um modelo de regressão linear, conforme indicado por @CALLAWAY2021200[p. 212]. Essa é a versão empírica da Equação \eqref{eq-dr-identification}.



Em conclusão, o processo de dedução do intervalo de confiança relevante para a inferência assintótica é efetivamente executado empregando uma abordagem de \textit{bootstrapping} de multiplicador direto. Essa técnica é explicada de forma abrangente em @CALLAWAY2021200[pp. 212-215]. Coletivamente, esses procedimentos facilitam o cálculo da influência causal da TZ nas receitas tributárias, permitindo assim a dedução subsequente sobre o impacto da política na dinâmica fiscal dos municípios brasileiros.



### Agregação dos efeitos médios de tratamento {#sec-aggregating}




Várias estruturas agregativas podem ser construídas com base na equação \eqref{eq-att-estimator-avg}. A síntese inicial dos efeitos médios diz respeito ao cálculo dos impactos do tratamento dentro de uma coorte específica ao longo do tempo. Essa síntese facilita a compreensão do efeito de heterogeneidade entre municípios que começaram a participação simultaneamente. O parâmetro delineado por @CALLAWAY2021200 é articulado da seguinte forma:
\begin{equation} \label{eq-group-aggte}
\theta_{sel}(g) = \frac{1}{T - g + 1} \sum_{t=g}^{T} ATT(g, t).
\end{equation}
$\theta_{sel}(g)$ representa o efeito médio ao longo de todos os períodos subsequentes pós-tratamento para o grupo $g$. É imperativo reconhecer que cada instância temporal recebe significância equivalente. Além disso, um coeficiente singular que encapsula efeitos abrangentes pode ser deduzido como:
\begin{equation} \label{eq-group-aggte-overall}
\theta_{sel}^O = \sum_{g \; \in \; \mathbb{G}} \theta_{sel}(g) P(G = g|G \leq T).
\end{equation}
Este parâmetro cumulativo é de uso geral proposto por @CALLAWAY2021200[p. 211] para aqueles que buscam uma figura de resumo singular. Ele equivale ao efeito médio do tratamento experimentado por todas as entidades submetidas ao tratamento em uma junção temporal única e é o parâmetro mais alinhado com a estimativa tradicional de DD dentro de uma estrutura $2 \times 2$.

O modelo DD fornece ainda uma interpretação dinâmica por meio de uma agregação baseada na duração da exposição ao tratamento. Inicialmente, denotamos por $e = g - t$ o tempo decorrido desde o início do tratamento. Portanto, a agregação é:
\begin{equation} \label{eq-dyn-time-aggte}
\theta_{es}(e) = \sum_{g \; \in \; \mathbb{G}} \mathds{1}\{G + e \leq T\} P(G = g|G + e \leq T) ATT(g, g + e).
\end{equation} A soma total é dada por:
\begin{equation} \label{eq-dyn-overall}
\theta_{es}^O = \frac{1}{T-1} \sum_{e = 0}^{T-2} \theta_{es}(e).
\end{equation}

A agregação em discussão incorpora complexidades, conforme delineado por @CALLAWAY2021200[p. 208-10]. A variabilidade na duração da exposição ao tratamento entre as unidades --- particularmente, a exposição mais longa das unidades tratadas inicialmente --- complica a análise do efeito cumulativo. Os pesos dinâmicos na Equação \eqref{eq-dyn-time-aggte}, que dependem da duração do tratamento entre as unidades, necessitam de ajuste cuidadoso. As comparações entre durações de tratamento variáveis ​​não refletem apenas diferenças nos efeitos do tratamento, mas também alterações na composição do grupo, potencialmente levando a conclusões errôneas se os pesos dinâmicos não forem calibrados corretamente.








Consequentemente, os autores definem um evento temporal $e' \text{ tal que } 0 \leq e \leq e' \leq T - 2$, e a estrutura de agregação balanceada para interpretação abrangente é delineada a partir daí:
\begin{equation} \label{eq-bal-dyn-time-aggte}
\theta_{es}^{bal}(e; e') = \sum_{g \; \in \; \mathbb{G}} \mathds{1}\{G + e' \leq T\} ATT(g, g + e) ​​P(G = g|G + e' \leq T).
\end{equation}
A equação especificada representa o impacto médio subsequente a $e$ iterações, garantindo que cada entidade de grupo-tempo seja igual e tenha passado por tratamento por um mínimo de $e'$ durações. Consequentemente, o efeito agregado pode ser deduzido da seguinte forma:
\begin{equation} \label{eq-dyn-bal-overall}
\theta_{es}^{O, bal}(e') = \frac{1}{e' + 1} \sum_{e = 0}^{e'} \theta_{es}^{bal}(e, e').
\end{equation}

Por fim, um método de agregação alternativo calcula o efeito médio do tratamento em um determinado tempo de calendário $t$ em todas as entidades que receberam tratamento naquele momento, que é articulado como:
\begin{equation} \label{eq-cal-time-aggte}
\theta_{c}(t) = \sum_{g \; \in \; \mathbb{G}} \mathds{1}\{t > g\} ATT(g, t) P(G = g| G \leq T).
\end{equation}
Esta equação produz o efeito médio para todas as entidades tratadas até o tempo $t$. A versão completa desta agregação é expressa por:
\begin{equation} \label{eq-dyn-overall}
\theta_{t}^O = \frac{1}{T-1} \sum_{t = 2}^{T} \theta_{c}(t).
\end{equation}

Cada técnica de agregação facilita uma interpretação do impacto conjunto, que deve ser abordada com prudência, particularmente em cenários caracterizados por heterogeneidade significativa nos efeitos do tratamento. O caso da TZ exemplifica tal cenário, como evidenciado em @sec-iss-results. Por outro lado, esses diversos métodos de agregação fornecem uma análise diferenciada dos efeitos, aprimorando assim a avaliação das implicações políticas.

\newpage




# Materiais e Métodos {#sec-materials-methods}


Esta seção delineia os recursos computacionais, conjuntos de dados e procedimentos estatísticos empregados na investigação empírica. O conjunto de dados é organizado em uma estrutura de painel longitudinal, compreendendo variáveis ​​pertinentes aos municípios brasileiros abrangendo de 2003 a 2019. Este conjunto de dados serve como base para avaliar os efeitos causais da iniciativa de Transporte Público Gratuito sobre os resultados fiscais dos municípios, especificamente a geração de receita tributária. A estrutura metodológica adotada é a abordagem Diferenças-em-diferenças (DD), que foi aumentada para incorporar efeitos de tratamento dinâmicos e garantir que a suposição de tendências paralelas seja atendida, condicional às covariáveis ​​observadas. A análise inferencial é facilitada pela implementação de uma técnica de estimativa duplamente robusta, culminando em uma avaliação agregada que elucida as implicações fiscais gerais da política de transporte.

## Pacotes R {#sec-r-packages}

Os principais pacotes usados ​​na análise --- e suas descrições resumidas --- são os seguintes:

1- \textit{\underline{Difference-in-Differences (did)}} [@did_r]: O pacote R \textbf{did} contém ferramentas para calcular parâmetros de efeito de tratamento médio em uma configuração Diferenças-em-diferenças permitindo: a) Mais de dois períodos de tempo; b) Variação no tempo de tratamento (ou seja, unidades podem ser tratadas em diferentes pontos no tempo); c) Heterogeneidade do efeito do tratamento (ou seja, o efeito de participar do tratamento pode variar entre unidades e exibir dinâmicas potencialmente complexas, seleção para tratamento ou efeitos de tempo); d) A suposição de tendências paralelas se mantém somente após o condicionamento em covariáveis.

2- \textit{\underline{Diferenças-em-diferenças duplamente robusta}} [@DRDID_r]: O pacote R \textbf{DRDID} implementa diferentes estimadores para o efeito médio de tratamento sobre os tratados (ATT) em configurações de diferenças-em-diferenças onde a suposição de tendências paralelas se mantém após o condicionamento em um vetor de covariáveis ​​de pré-tratamento. Ele é usado por meio do pacote DiD.




## Dados {#sec-data}

```{r}
#| label: import-functions

# importing the functions
source(file.path(getwd(), "src", "functions.r"))
```

```{r}
#| label: did-file
#| cache: true
#| results: hide

  # Did analysis
source(file.path(getwd(), "src", "did.r"))
```


Na presente análise, a política de Tarifa Zero é examinada como um desenho quase-experimental. Dada a natureza não aleatória da intervenção, é imperativo levar em conta potenciais variáveis ​​de confusão para verificar o impacto causal da isenção de tarifa na receita tributária. Se todas as informações necessárias estiverem disponíveis, os resultados potenciais podem ser tratados como aleatórios, condicionais a covariáveis. Os dados para ajustar os modelos precisam estar no formato de "dados em painel" (dados longitudinais, no jargão estatístico). Em resumo, os dados devem ter informações sobre as unidades (municípios) e tempo (anos) e nenhuma restrição na correlação de séries temporais é necessária, em princípio [@CALLAWAY2021200, p. 203].

Portanto, dados pertencentes aos municípios brasileiros serão utilizados para este estudo. As potenciais variáveis ​​de confusão servirão como covariáveis ​​de controle ($\boldsymbol{X_i}$) dentro da estrutura analítica do modelo de Diferenças-em-diferenças. O conjunto de dados abrange registros municipais abrangendo de 2003 a 2019, apresentando assim um híbrido de dados transversais e de séries temporais. Detalhes sobre o ano de implementação da política de TZ podem ser encontrados em @Santini-FFPT-2024^[Acessado em 05/04/2024], enquanto os dados de receita tributária foram obtidos de @IPEA-iss-2020. Do Instituto Brasileiro de Geografia e Estatística (IBGE), os conjuntos de dados são: Produto Interno Bruto (PIB) Municipal, projeções populacionais e área dos municípios.


## Métodos {#sec-methods}


A avaliação do impacto da política de Tarifa Zero na receita tributária necessita da aplicação da abordagem Diferenças-em-Diferenças, conforme delineado na @sec-did. Essa metodologia é necessária devido à impraticabilidade de um ensaio clínico aleatorizado. Dada a variação temporal na adoção da política, uma análise de tratamento de variação temporal foi conduzida, conforme explicado em @sec-did-time-varying. Os grupos de controle foram constituídos por municípios que nunca implementaram a política ou ainda não o fizeram, limitando a amostra a Estados com pelo menos um município que promulgou a política. O ano de início da TZ serviu como critério para classificação do grupo.

A compilação de dados, conforme detalhado na @sec-data, foi executada utilizando sites institucionais oficiais. A @sec-exploratory elucida as características dos dados primários, fornecendo ideias sobre a TZ, arrecadação de impostos e variáveis ​​de controle --- empregadas para mitigar o viés de seleção --- com discussões apresentadas na @sec-did-covariates. Variáveis ​​econômicas e demográficas foram transformadas logaritmicamente (logaritmo natural) para minimizar discrepâncias no formato dos dados. Além disso, variáveis ​​monetárias foram ajustadas para inflação usando o Índice de Preços ao Consumidor Amplo (IPCA) para refletir os valores de dezembro de 2020. Os pacotes R, conforme introduzidos em @sec-r-packages, sustentam a estrutura metodológica principal, com saídas de função adaptadas para se alinharem com as descobertas e discussões nos resultados em @sec-results e discussões em @sec-disc-conclusions.





The primary model's estimation, pursuant to Equation \eqref{eq-att-estimator}, represents the initial phase in evaluating potential aggregations, as discussed in @sec-aggregating. This phase encompasses group, dynamic (whether balanced or not), and calendar time aggregations to ensure the robustness of the results,  safeguarding against the possibility of spurious findings contingent upon the structural design of the model. These aggregations were facilitated by the functionalities provided within the referenced R packages, with all inferential statistics reported at a 95% confidence interval. To further fortify against selection bias, diverse sets of covariates were employed, alongside an examination of the parallel trends assumption via an event-study analytical framework.


A estimativa do modelo principal, de acordo com a Equação \eqref{eq-att-estimator}, representa a fase inicial na avaliação de agregações potenciais, conforme discutido em @sec-aggregating. Esta fase abrange agregações de grupo, dinâmicas (balanceadas ou não) e de tempo de calendário para garantir a robustez dos resultados, protegendo contra a possibilidade de descobertas espúrias dependentes do desenho estrutural do modelo. Essas agregações foram facilitadas pelas funcionalidades fornecidas nos pacotes R referenciados, com todas as estatísticas inferenciais relatadas em um intervalo de confiança de 95%. Para testar contra o viés de seleção, diversos conjuntos de covariáveis ​​foram empregados, juntamente com um exame da suposição de tendências paralelas por meio de uma estrutura analítica de estudo de eventos.

\newpage

# Resultados {#sec-results}

Os resultados são apresentados nas seções a seguir. A primeira seção detalha a análise exploratória de dados, que inclui a atribuição de tratamento escalonado da política de transporte público gratuito. As seções subsequentes delineiam a análise de inferência causal, abrangendo a estimativa do Efeito Médio do Tratamento sobre os Tratados e os efeitos agregados do tratamento. A seção final fornece uma análise abrangente das implicações fiscais da política sobre os municípios brasileiros.




## Exploratory Data Analysis {#sec-exploratory}


Portanto, as unidades sujeitas a tratamento ou atuando como controle estão em @fig-plot-staggered. A implementação de atribuições de tratamento escalonadas frequentemente caracteriza metodologias quase-experimentais. Essa abordagem é notável na adoção da política de Tarifa Zero. No período de 2003 a 2019, 27 municípios adotaram essa política. Dado que a promulgação de tal política está sujeita à aplicação discricionária, a estrutura metodológica proposta deve ser empregada dependendo da confiabilidade de suas suposições subjacentes.


```{r}
#| output: false

plot_staggered  <- 
panelview(data             = did_iss$panel_data,
          Y                = "log_iss",
          D                = "treated",
          X                = c("log_gdp", "log_pop", "log_area"),
          index            = c("ibge_code", "year"),
          pre.post         = TRUE,
          display.all      = TRUE,
          collapse.history = TRUE,
          background       = "white",
          xlab             = "Year",
          theme            = TRUE,
          ylab             = "Número de Municípios",
          main             = "Histórias únicas dos municípios",
          legend.labs      = c("Controle", "Tratado (Pré)", "Tratado (Pós)"),
          by.timing        = TRUE) +
  common_theme() +
  theme(legend.position = "bottom") +
  # theme(plot.margin = unit(c(0, 0, 0, 0), "cm")) + # Set margins to zero
  scale_x_continuous(breaks = seq(1, 17, 2),
                     labels = seq(2003, 2019, 2)) 


  
```

```{r}
#| label: fig-plot-staggered
#| fig-cap: Adoção Escalonada da política de Tarifa Zero.
#| fig-height: 4

plot_staggered 
```


```{r}
# saving the graph (transitory to the project presentation)

plot_staggered |> 
ggsave(filename = "img/plot_staggered-pt.png",
       width    = 7,
       height   = 5)
  
```


Na avaliação de fatores causais que influenciam uma variável de resultado, prevê-se que uma variação na variável resposta, ascendente ou descendente, será observada. Essa expectativa é baseada na hipótese de que a causa sob avaliação exerce um efeito mensurável na variável de resultado em questão. A média em cada coorte do efeito do tratamento na receita do ISS é apresentada em @fig-iss-cohort. O termo "coorte" se refere a um conjunto de municípios que implementaram simultaneamente o Fare-Free no mesmo ano civil.

Observacionalmente, essas coortes demonstraram uma tendência de crescimento progressivo na receita do ISS nos anos que sucederam sua adoção da TZ, mantendo uma trajetória ascendente ou revertendo um declínio anterior. Esse padrão indica um período de ajuste e eventual estabilização em um patamar operacional elevado, refletindo a assimilação da nova maneira de organização do transporte público.

```{r}
#| label: fig-iss-cohort
#| fig-cap: Receita Log(ISS) por coorte. O período de tratamento está em azul. Os eixos verticais variam de acordo com o subplot.
#| fig-height: 6


  # Recovering the treated units (until 2019)
treated_units_iss <- did_iss$panel_data |>
  filter(start_year <= 2019,
         treated == 1) |>
  pull(ibge_code) |>
  unique()


  # Average treatment effect by cohort
tbl_iss_cohort <- 
did_iss$panel_data |>
  filter(ibge_code %in% treated_units_iss) |>
  summarise(mean_iss = mean(log_iss),
            mean_iss_level = mean(iss_collection),
            mean_iss_per_capita = mean(iss_collection / pop_datasus),
            .by = c(year,
                    start_year,
                    treated)) |> # To build the graph colors pre and post-treatment
  mutate(macro_group_year = cut(
    start_year,
    breaks = quantile(start_year, probs = c(0, .25, .5, .75, 1)), # To create for facets
    include.lowest = TRUE
  ))

  # Plotting the average treatment effect by cohort
(plot_iss_cohort <-
  tbl_iss_cohort |>
  ggplot(aes(
    x     = year,
    y     = mean_iss,
    group = factor(start_year),
    color = factor(treated) # To color pre and post-treatment
  )) +
  geom_line(size = 1) +
  #geom_text_repel(                # Label of the cohorts
   # data = . %>%
    #  filter(year == 2019),
   # aes(x     = 2019.5,
    #    label = start_year),
   # hjust = 0,
   # vjust = 0,
    # position = position_jitter( # Trying to avoid overlapping
    #   # width  = 1,
    #   height = 10,
    #   seed   = 2021
    # ),
   # size = 2.5,
   # box.padding = 0.05,
   # direction = "y",
   # seed = 2024,
    # nudge_x = 0.5,
    #nudge_y = 0.5,
    #check_overlap = TRUE
  #) +
  # geom_text(label = "Start year",
  #           x     = 2019.5,
  #           y     = quantile(tbl_iss_cohort$mean_iss, 0.25),
  #           color = "black",
  #           hjust = 0,
  #           vjust = 0) +
  facet_wrap(~ start_year,
             ncol = 3,
             scales = "free"
# Nudge the starting positions

             ) +  # Facet by the quartiles of the start year
  #theme_bw() +
  common_theme() +
  theme(legend.position = "none") +
  labs(
    x     = "Ano",
    #y     = "Mean of the ISS revenue per capita (BRL)",
    y     = "Logaritmo da Receita de ISS (milhões de R$)",
    title = "Evolução da receita média de log(ISS) por grupo em milhões de reais
a preços de dezembro de 2020",
    # title = "Mean of the ISS revenue per capita evolution by group (treatment period in blue)",
    #color = "Treatment"
  ) +
  scale_color_manual(values = c("grey", "#1874CD")) +
  scale_x_continuous(breaks = seq(2003, 2020, 5),
                     limits = c(2003, 2020)) )


  
```




```{r}
# Year of reference to descriptive analysis

year_ref <- 2010
```



A sobreposição de conjuntos de informações variáveis ​​constitui uma suposição adicional dentro da estrutura do modelo (veja @sec-did-covariates). Isso requer verificação por meio de uma abordagem analítica descritiva. O gráfico de densidade, conforme representado em @fig-density, ilustra que as distribuições das variáveis ​​de resposta e covariáveis ​​coincidem amplamente. Considerando as condições de tratamento que variam com o tempo, as estatísticas descritivas para o ano de referência de `r year_ref` são apresentadas independentemente do ponto de partida real do tratamento. A representação gráfica revela que a transformação logarítmica da área territorial exibe uma distribuição altamente semelhante entre os grupos tratados e não tratados. As três variáveis ​​restantes, também transformadas logaritmicamente, exibem pequenas discrepâncias distribucionais. No entanto, a extensão da sobreposição e a similaridade no desenho das curvas permanecem perceptíveis.


```{r}
#| label: fig-density
#| fig-cap: Gráfico de densidade da variável resposta e das covariáveis. 
#| fig-height: 4

# Density plot of the response variables and covariates
density_plot_response <- density_plot(year_ref = year_ref)

density_plot_response +
labs(x = "Valor (logaritmo)",
     y = "Densidade",
     title = "Gráfico de densidade das variáveis de acordo com o status de tratamento
(ano de referência: 2010)") +
scale_fill_manual(values = c("#1874CD", "grey"),
                  labels = c("Tratados", "Não Tratados"))
```



```{r}
# saving the graph (transitory to the project presentation)


density_plot_response |> 
ggsave(filename = "img/density_plot_response-pt.png",
       width    = 7,
       height   = 5)
  
```

Além disso, os valores médios e medianos, referenciados em @tbl-descriptive-mean e @tbl-descriptive-median respectivamente, destacam as composições entre os grupos tratados e de controle. Enquanto as diferenças médias para os logaritmos da receita de ISS, população e PIB são estatisticamente significativas, as estatísticas de ordem retratam um padrão mais congruente.

```{r}
#| label: tbl-descriptive-mean
#| tbl-cap: Estatísticas descritivas das médias da variável de respsota e das covariáveispor status de tratamento.
#| eval: true

tbl_descriptive(year_ref = year_ref) |> 
  # select(-`p-value`) |> 
  as_gt() |> 
  tab_options(table.font.size = "12px") |> 
  cols_hide(columns = contains("value")) |> 
  as_latex() 
```


```{r}
#| label: tbl-descriptive-median
#| tbl-cap: Estatísticas descritivas das medianas da variável de respsota e das covariáveispor status de tratamento.

tbl_descriptive(year_ref = year_ref,
                mean = FALSE) |> 
  as_gt() |>
  tab_options(table.font.size = "12px") |> 
  as_latex()
```


Dado que essas variáveis ​​exibem um certo nível de assimetria, mesmo em uma escala logarítmica, esses resumos ordenados fornecem informações adicionais sobre as condições sobrepostas. Consequentemente, o conjunto de dados atual parece satisfazer vários dos pressupostos do modelo de Diferenças-em-diferenças.

## Aplicação

Duas investigações essenciais na avaliação da validade de um modelo causal por meio de dados observacionais dizem respeito aos determinantes da alocação de tratamento e ao conhecimento das unidades tratadas sobre a variável de resposta. O viés de seleção introduz ruído na estimativa de efeitos causais, necessitando de um exame meticuloso. A dependência da adoção do tratamento em condições antecedentes da variável de resultado amplifica a necessidade de vigilância na afirmação das pressuposições do modelo.

No caso presente, a proposição de uma política de transporte público gratuito é conduzida por uma articulação da prefeitura municipal sob o endosso da legislatura local, dependente de uma demonstração de viabilidade fiscal. Dado que as projeções orçamentárias são especulativas, a condição fiscal real do município não constitui um impedimento primário. Além disso, a coleta do Imposto sobre Serviços espelha a atividade econômica, tornando improvável um esforço artificial para inflá-lo para justificar a implementação do TZ.



Além disso, o processo de tomada de decisão abrange todas as entidades políticas locais. Os debates em torno da TZ geralmente envolvem organizações civis, organizações não governamentais, usuários de transporte público e outros, indicando que a promulgação de políticas raramente é da alçada de um indivíduo solitário ou confinada a um grupo seleto de municípios. Na ausência de mandatos legislativos específicos para esse tipo de política de transporte público, a natureza coletiva da tomada de decisão impede a existência de uma causa independente dentro desse ambiente de pesquisa que tornaria todas as entidades tratadas únicas e, portanto, criaria dilemas de viés de seleção insolúveis.

No contexto da relação recíproca entre variáveis ​​de tratamento e resultado, a promulgação da política de FFTP não parece ser uma consequência direta das flutuações na receita do Imposto sobre Serviços. Além disso, como o impacto da TZ nas receitas fiscais permanece indeterminado, o aumento da receita tributária não é o principal ímpeto por trás da introdução da política. Dado que as despesas com transporte público geralmente representam uma parcela significativa dos orçamentos familiares, o capital político obtido pela autoridade implementadora pode justificar tais compromissos fiscais. Outras motivações descritas em @sec-fftp-policy também podem ser significativas.



```{r}
ci_group_perc <- get_overall_att_ci(did_iss$group_aggte, digits  = 1, percent = TRUE)
```


## Receita de Imposto sobre Serviços (ISS) {#sec-iss-results}




O Imposto sobre Serviços (ISS) está intrinsecamente vinculado às atividades econômicas, tornando-o vulnerável a mudanças na alocação de fundos anteriormente destinados aos custos de transporte público. A literatura econômica sugere que a elasticidade de renda dos serviços é considerável [@fuchs_1965]. Isso implica que o consumo de serviços e bens de uma família tende a aumentar à medida que sua renda disponível aumenta, exemplificado pela economia com despesas de transporte. Se os serviços apresentarem maior elasticidade de renda do que os bens, um aumento nos padrões de consumo de serviços e, consequentemente, na receita do imposto ISS é antecipado^[Se os bens demonstrarem maior elasticidade do que os serviços na liberação de renda, uma condição elevada de imposto sobre bens seria observada.].

Se essa hipótese for validada, a implementação da política de Tarifa Zero pode levar a um aumento no consumo que excede o crescimento orgânico, aumentando assim as receitas fiscais além da tendência existente. Esse aumento potencial no consumo pode melhorar o bem-estar individual e fortalecer a estabilidade financeira dos governos municipais por meio do aumento da arrecadação de impostos. No entanto, a suficiência desse aumento para contrabalançar as despesas relacionadas justifica um exame empírico adicional.




### Efeito Médio do Tratamento nos Grupos



Agregar grupos com base no ano de adoção da Tarifa Zero envolve calcular o impacto causal médio na variável dependente para entidades que implementaram a política simultaneamente. Além disso, o efeito médio agregado de tratamento nos tratados é derivado como uma média ponderada em todos os valores do grupo. Essa métrica duplamente agregada se aproxima mais do estimador usado em modelos convencionais de regressão de efeitos fixos "bidirecionais", conforme referenciado por @CALLAWAY2021200[p. 211]. A base do modelo é dada em @sec-did-covariates, cujos resultados são agregados pelo processo delineado pela Equação \eqref{eq-group-aggte}, enquanto o resumo abrangente do ATT é computado seguindo a Equação \eqref{eq-group-aggte-overall}. As unidades ainda não tratadas também foram incluídas na análise, como parte das unidades de controle.

Os resultados resumidos são exibidos em @fig-pop_gdp_pop_group, onde cinco grupos demonstraram efeitos positivos estatisticamente significativos e quatro exibiram efeitos negativos. Os resultados também são apresentados em @tbl-pop_gdp_pop_group. O resumo geral é estatisticamente positivo e significativo, sugerindo que a adoção da TZ está associada a um aumento de `r round(did_iss$group_aggte$overall.att * 100, 1)`% `r ci_group_perc` na receita do ISS, potencialmente devido à atividade econômica aprimorada. Vale a pena avaliar esses resultados junto com o fato de que os primeiros a adotar apresentam mais anos de resultados para serem calculados.

Notavelmente, os primeiros a adotar mostram efeitos maiores, mas os resultados divergentes entre os grupos sinalizam uma dependência potencial do ciclo de negócios e das condições locais. Além disso, a composição instável do grupo pode influenciar os resultados. Recomenda-se que pesquisas subsequentes abordem esses aspectos. Além disso, a precisão dessas estimativas provavelmente melhorará à medida que municípios adicionais adotarem a política.





```{r}
#| label: fig-pop_gdp_pop_group
#| fig-cap: DD para o efeito médio do tratamento por grupo (PIB, população e área, em logaritmos, como covariáveis).
#| fig-height: 4


# Confidence interval
ci_group <- get_overall_att_ci(did_iss$group_aggte) 


# Lower bound for the confidence interval
lower_bound <- did_iss$summary_group_aggte$lower_bound

# Y axis band
ci_band_group <- max(lower_bound) * 3

# Plot

(plot_did_gdp_pop_group <-
  ggdid(
    did_iss$group_aggte,
    xlab  = "ATT (logaritmo da arrecadação de ISS)",
    ylab  = "Grupo",
    title = "Efeito médio do tratamento nos tratados sobre o ISS por grupo",
    xlim  = c(-ci_band_group, ci_band_group)
  ) +
  geom_text(aes(
    x     = ci_band_group * 0.8,
    y     = length(lower_bound) * 0.7,
    # Axis is not in years values
    label = paste("Agregado geral do \n ATT = ", ci_group),
    vjust = -1.5
  ),
  size  = 3.5) + 
  common_theme() +
  theme(legend.position = "bottom"))


```

```{r}
# saving the graph (transitory to the project presentation)

plot_did_gdp_pop_group |>
ggsave(filename = "img/fig-gdp-pop-group-pt.png",
       width    = 7,
       height   = 5)
  
```



```{r}
#| label: tbl-pop_gdp_pop_group
#| tbl-cap: DD para o efeito médio do tratamento por grupo (PIB, população e área, em logaritmos, como covariáveis).

print_summary_latex(did_iss$summary_group_aggte) |> 
  kable_styling(font_size = 9)
```




### Efeitos Dinâmicos de Tratamento 



A variabilidade dos efeitos do tratamento pode ser contingente à estrutura causal subjacente. Por exemplo, uma política pode exibir efeitos defasados ​​se seu mecanismo operacional necessitar de modificações comportamentais entre seus destinatários. Por outro lado, um tratamento pode gerar uma alteração imediata e singular na variável de resultado, desprovida de variações subsequentes. Assim, uma agregação sintonizada com a duração da exposição pré e pós-tratamento pode elucidar a acomodação de efeitos dinâmicos.

A influência temporal da adoção da TZ calculada usando a Equação \eqref{eq-dyn-time-aggte} é ilustrada em @fig-pop-gdp. Nesta conjuntura, o marcador de tempo zero denota o efeito imediato da adoção, enquanto um comprimento de $-1$ significa o intervalo imediatamente anterior à implementação da política. A análise preliminar sugere que as estimativas do efeito são predominantemente estáveis ​​antes do tratamento e se tornam positivas após o tratamento. Um padrão discernível no gráfico indica que o impacto da TZ na arrecadação de receitas do ISS se intensifica progressivamente, culminando em um valor médio de pico em aproximadamente sete a dez anos após a adoção. Além disso, parece não haver desvio da suposição de tendência paralela antes da introdução do tratamento, como evidenciado pela ausência de disparidades significativas entre as coortes de tratamento e controle (conforme representado pelos pontos vermelhos).

Uma avaliação somativa do efeito do tratamento calculada pela Equação \eqref{eq-dyn-overall} produz um resultado positivo (`r round(did_iss$dyn_aggte$overall.att * 100, 1)`% `r get_overall_att_ci(did_iss$dyn_aggte, percent = TRUE, digits = 1)`), significando uma influência positiva da TZ no acúmulo de imposto ISS. No entanto, essa agregação está sujeita a certas limitações. Dado que a duração da exposição depende do grupo e da progressão temporal correspondente, as estimativas apresentadas são inerentemente desequilibradas --- ou seja, os efeitos associados à duração da exposição são avaliados apenas dentro de entidades que atingiram tal marco temporal. Para corrigir esse desequilíbrio, uma abordagem equilibrada para agregação de efeitos dinâmicos pode ser empregada.


```{r}
#| label: fig-pop-gdp
#| fig-cap: DD para o efeito médio do tratamento pela duração da exposição (PIB, população área em logaritmo como covariáveis).
#| fig-height: 4


# Confidence interval
ci_dyn <- get_overall_att_ci(did_iss$dyn_aggte)


# Y axis band
ci_band_dyn <- max(did_iss$summary_dyn_aggte$std_error, na.rm = TRUE) * 4

# Plot
(plot_did_gdp_dyn <- 
ggdid(did_iss$dyn_aggte,
      #ylim = c(-ci_band_dyn, ci_band_dyn),
      xlab  = "Duração da exposição (em anos)",
      ylab  = "ATT (logaritmo do ISS)",
      title = "Efeito médio do tratamento nos tratados (ATT) sobre o ISS
por tempo de exposição") +
  geom_text(aes(
    x     = 0,
    y     = ci_band_dyn * 0.4,
    label = paste("Agregado geral do\n ATT = ", ci_dyn),
    vjust = -1.5
  ),
  size  = 4) +
  scale_x_continuous(breaks = seq(-15, 15, 3)) +
  common_theme() + 
  theme(legend.position = "bottom"))
  
```

```{r}
# saving the graph (transitory to the project presentation)

plot_did_gdp_dyn |> 
ggsave(filename = "img/fig-gdp-pop-dyn-pt.png",
       width    = 7.5,
       height   = 5)
  
```

#### Efeitos Dinâmicos Balanceados




Os efeitos dinâmicos da política de Tarifa Zero sobre a receita do Imposto sobre Serviços são estimados de forma equilibrada, delineados pela Equação \eqref{eq-bal-dyn-time-aggte} e descritos em @fig-pop-gdp-area-balanced. Esta análise é limitada a municípios que implementaram a política por um mínimo de cinco anos. Tal abordagem é defendida em instâncias de heterogeneidade de grupo [@did_r], fazendo a média das mesmas unidades em todos os períodos anteriores e posteriores ao tratamento.

Por outro lado, a dinâmica se assemelha muito àquela observada ao considerar todas as unidades tratadas. Antes da implementação da TZ, os municípios tratados exibiam variações negativas/nulas na arrecadação do ISS em relação aos grupos de controle. Após o tratamento, essa tendência se inverteu, resultando em diferenciais positivos. O resumo geral --- havia `r did_iss$n_balanced` unidades com informações completas --- indica um aumento na receita do Imposto sobre Serviços em `r round(did_iss$dyn_aggte_bal$overall.att * 100, 1)`% `r get_overall_att_ci(did_iss$dyn_aggte_bal, digits = 1, percent = TRUE)`, embora com significância estatística marginal.



```{r}
#| label: fig-pop-gdp-area-balanced
#| fig-cap: DD para o efeito médio do tratamento pela duração da exposição com balanceamento equilibrado (PIB, população área em logaritmo como covariáveis).
#| fig-height: 4


# Confidence interval
ci_dyn_bal <- get_overall_att_ci(did_iss$dyn_aggte_bal, digits = 3)

# Y axis band
ci_band_dyn_bal <- max(did_iss$summary_dyn_aggte_bal$std_error,
                       na.rm = TRUE) * 3

# Plot
plot_did_gdp_dyn_bal <- 
ggdid(did_iss$dyn_aggte_bal) +
  geom_text(aes(
    x     = 0,
    y     = -ci_band_dyn_bal * 1.5,
    label = paste("Agregado geral do\n ATT = ", ci_dyn_bal),
    vjust = -1.5
  ),
  size  = 4) +
  common_theme() +
  theme(legend.position = "bottom") + 
  labs(x  = "Tempo de exposição (em anos)",
       y  = "ATT (logaritmo do ISS)",
       title = "Efeito médio do tratamento nos tratados (ATT) sobre o ISS
por unidades com um período mínimo de 5 anos de adoção")
  

plot_did_gdp_dyn_bal
```



```{r}
# saving the graph (transitory to the project presentation)

plot_did_gdp_dyn_bal |> 
ggsave(filename = "img/plot_did_gdp_dyn_bal-pt.png",
       width    = 7.5,
       height   = 5)
  
```




### Efeito do Tratamento por Tempo de Calendário


In conjunction with the aforementioned aggregations, examining the effect in each year of adoption could shed light on the variability of the treatment effect contingent on the year of analysis. The Difference-in-Differences framework neutralizes the influence of unit-specific variables that remain constant over time or affect all units uniformly. The "calendar effect" then measures the impact of year-specific economic conditions on the FFPT policy's influence on ISS collection. Notable distinct effects suggest that economic cycles may elucidate the variable effects. These calendar effects given by Equation \eqref{eq-cal-time-aggte} are illustrated in @fig-gdp-pop-calendar.


Em conjunto com as agregações mencionadas acima, examinar o efeito em cada ano de adoção pode lançar luz sobre a variabilidade do efeito do tratamento contingente ao ano de análise. A estrutura de Diferença-em-diferenças neutraliza a influência de variáveis ​​específicas da unidade que permanecem constantes ao longo do tempo ou afetam todas as unidades uniformemente. O "efeito calendário" mede então o impacto das condições econômicas específicas do ano na influência da política de TZ na arrecadação do ISS. Efeitos distintos notáveis ​​sugerem que os ciclos econômicos podem elucidar os efeitos das variáveis. Esses efeitos de calendário dados pela Equação \eqref{eq-cal-time-aggte} são ilustrados em @fig-gdp-pop-calendar.

Neste modelo específico, o efeito médio do tratamento é `r round(did_iss$calendar_aggte$overall.att * 100, 1)`% `r get_overall_att_ci(did_iss$calendar_aggte, digits = 1, percent = TRUE)`, apesar da ausência de discrepâncias significativas nos efeitos do tratamento ao longo dos anos estudados (todos positivos).



```{r}
#| label: fig-gdp-pop-calendar
#| fig-cap: DD para o efeito médio do tratamento por tempo de calendário (PIB, população área em logaritmo como covariáveis).
#| fig-height: 4

# Confidence interval
ci_calendar <- get_overall_att_ci(did_iss$calendar_aggte)

# Y axis band
ci_band_calendar <- max(did_iss$summary_calendar_aggte$lower_bound) * 10

# Plot
ggdid(did_iss$calendar_aggte,
      ylim = c(-ci_band_calendar, ci_band_calendar)) +
  geom_text(aes(
    x     = 2016,
    y     = ci_band_calendar * 0.4,
    label = paste("Agregado Geral do\n ATT = ", ci_calendar),
    vjust = -1.5
  ),
  size  = 4) +
  common_theme() +
  theme(legend.position = "bottom") + 
  labs(x  = "Ano",
       y  = "ATT (logaritmo do ISS)",
       title = "Efeito médio de tratamento nos tratados (ATT) sobre o ISS por ano") +
  scale_x_continuous(breaks = seq(2004, 2018, 2))
  
```


A last caveat is that the calendar-time treatment effects depends on the size of the groups. The summary statistics are in @tbl-gdp-pop-calendar.


```{r}
#| label: tbl-gdp-pop-calendar
#| tbl-cap: Resumo do DD para o efeito médio do tratamento por tempo de calendário (PIB, população área em logaritmo como covariáveis).

print_summary_latex(did_iss$summary_calendar_aggte) |> 
  kable_styling(font_size = 9) 
```


## Análise de Sensitividade {#sec-sensitivity-analysis}



Nesta Seção, uma análise de sensibilidade foi conduzida para avaliar a robustez do modelo. No @sec-covariates-sensitivity, conjuntos distintos de covariáveis ​​são testados. No @sec-event-study, a suposição de tendências paralelas está sob (embora limitada) análise.

### Avaliação de Conjuntos Distintos de Covariáveis ​​{#sec-covariates-sensitivity}

A estrutura das covariáveis ​é usada para validar a suposição de tendências paralelas. Na ausência de tal estrutura, os efeitos estimados podem ser confundidos, levando a resultados tendenciosos. Configurações alternativas do modelo podem ser exploradas para determinar as implicações de alterações na estrutura da covariável. Essas descobertas são delineadas em @tbl-other-models. A ausência de covariáveis ​​resulta em efeitos de grupo e dinâmicos que são estatisticamente indistinguíveis de zero. Isso indica que variáveis ​​como população e PIB são fatores influentes nos resultados da coleta do ISS ao contrastar grupos tratados e não tratados, dado que suas distribuições não coincidem totalmente (consulte @fig-density).


```{r}
#| label: tbl-other-models
#| tbl-cap: Efeito médio estimado do tratamento por diferentes estruturas de covariáveis.

tbl_comparison |> 
  group_by(Aggregation) |> 
  gt() |>
  tab_source_note("Significado do código: `*' banda de confianção não inclui 0.") |> 
  tab_source_note("Todos os modelos incluem intercepto.") |> 
  tab_options(table.font.size = "12px") |> 
  as_latex()
```


Uma comparação entre os modelos com covariáveis ​​completas e parciais revela uma convergência de valores, embora o modelo com o conjunto total de covariáveis ​​registre valores marginalmente mais altos. Essa convergência reforça a confiabilidade das descobertas do modelo. Consequentemente, um conjunto abrangente de covariáveis, que se alinha com a estrutura teórica, garante a manutenção da suposição de tendência paralela e a exclusão de variáveis ​​de confusão.

### Tendências paralelas: um estudo de evento {#sec-event-study}

A suposição de tendências paralelas constitui uma premissa fundamental na avaliação de inferências causais, apesar de sua inerente inverificabilidade em contextos empíricos. Uma abordagem metodológica para aproximar a validação dessa suposição é a implementação de uma análise de estudo de evento, que examina a consistência de tendências paralelas antes da intervenção. Isso é exemplificado na @fig-event-study, em que os pontos de dados cinza demarcam a fase de pré-intervenção, revelando discrepâncias insignificantes antecedentes à adoção do tratamento. Por outro lado, estimativas pós-tratamento corroboram as descobertas delineadas em seções antecedentes.

Estudos de eventos servem como uma metodologia essencial para estimar efeitos dinâmicos de tratamento utilizando dados de painel, em que o ponto zero demarca o ano inaugural da intervenção. Dentro dessa estrutura, combinações temporais antecedentes e subsequentes à adoção do tratamento são encapsuladas no modelo de regressão. @Miller-2023 postula que uma ausência de tendência seja observada antes do tratamento. Desvios desse padrão esperado podem indicar a presença de variáveis ​​de confusão, potencialmente tornando o modelo especioso. Essas anomalias também sugerem problemas potenciais com a suposição de tendências paralelas.



```{r}
#| label: fig-event-study
#| fig-cap: Estudo de evento para o efeito médio de tratamento sobre a arrecadação de ISS (PIB, população área em logaritmo como covariáveis).
#| fig-width: 4

iss_event_study$plot +
  labs(title = "Estudo de evento para tendências paralelas condicionais
na arrecadação de ISS",
x = "Tempo de exposição",
y = "ATT (logaritmo do ISS)") +
  common_theme() +
  theme(legend.position = "none") + 
  scale_x_continuous(breaks = seq(-15, 15, 3)) 

```



A suposição de tendência paralela serve para autenticar que os resultados observados não são atingíveis independentemente da implementação da política. Embora a suposição esteja intrinsecamente ligada à tendência paralela pós-tratamento --- tornando-a empiricamente não verificável --- a análise da fase de pré-tratamento pode fornecer algum suporte probatório. Na ausência de convergência pré-tratamento, a plausibilidade da sustentação das tendências paralelas pós-tratamento torna-se questionável.



\newpage

# Discussão e Conclusões {#sec-disc-conclusions}

A viabilidade de um design experimental envolvendo a implementação aleatória de uma política de Tarifa Zero (TZ) é comprometida devido à sua natureza inerentemente política, que depende da agenda da governança local. Consequentemente, a avaliação de relações causais necessita de um design de estudo observacional. A estrutura analítica de Diferença-em-diferenças (DD) fornece uma estrutura para extrair inferências causais, desde que as suposições subjacentes sejam atendidas. A validade da identificação do efeito causal depende da satisfação de tendências paralelas, da SUTVA e da ausência de efeitos de antecipação. A incorporação de covariáveis ​​permite fazer afirmações causais, garantindo a robustez das suposições do modelo.


```{r}
ci_dyn <- get_overall_att_ci(did_iss$dyn_aggte, digits  = 1, percent = TRUE)
```


Após a aplicação da estrutura analítica do DD, a evidência empírica sugere um impacto positivo estatisticamente significativo da política de Transporte Público Gratuito sobre a arrecadação do Imposto sobre Serviços (ISS). O efeito médio do tratamento sobre os tratados (ATT) em toda a coorte de municípios que instituíram simultaneamente a isenção de tarifa revela um aumento das receitas do ISS em uma estimativa de `r round(did_iss$group_aggte$overall.att * 100, 1)`% --- o intervalo de confiança de 95% é `r ci_group_perc`. Este estimador se alinha estreitamente com o modelo DD convencional dois por dois. O conjunto de covariáveis ​​é dado pelos logaritmos do PIB, população e área.

Após o exame dos efeitos dinâmicos contingentes em relação à duração da adoção da política, o ATT avaliado foi `r round(did_iss$dyn_aggte$overall.att * 100, 1)`% `r ci_dyn`. O intervalo de confiança positivo sugere que, apesar do tamanho limitado da amostra, as ramificações do efeito da TZ na arrecadação de impostos podem exibir variabilidade temporal. Métricas subsequentes corroboram essa tendência positiva, embora com magnitudes marginalmente variáveis. O aumento fiscal observado está ostensivamente ligado a uma realocação de gastos familiares de tarifas de transporte público para o consumo de serviços e bens. O redirecionamento de recursos financeiros do financiamento baseado em tarifas para mecanismos alternativos é imperativo para a implementação sustentada dessa política pública.

No entanto, é imperativo reconhecer as limitações inerentes a essa abordagem metodológica, particularmente quando aplicada a um tamanho de amostra limitado, como é o caso em nosso estudo. Com apenas 27 municípios adotando a TZ dentro do período estudado, os intervalos de confiança para análises temporais ou específicas de grupo frequentemente produzem resultados inconclusivos, apesar de dados agregados mais robustos. Consequentemente, pesquisas adicionais incorporando um tamanho de amostra maior são aconselháveis ​​quando dados adicionais estiverem disponíveis. Por exemplo, em maio de 2024, o número de municípios que adotaram o TZ expandiu para 108. Espera-se que essa expansão forneça estimadores mais robustos para análises gerais e dinâmicas. Além disso, um exame exaustivo das modificações na legislação tributária poderia melhorar significativamente o estudo. Isso é particularmente pertinente se uma mudança legislativa permitir uma entrada em vigor escalonada. Tal análise forneceria uma compreensão abrangente das mudanças incrementais e seus impactos potenciais na aplicação da lei tributária.

É necessária uma exploração mais aprofundada das motivações por trás da adoção do TZ. Os comportamentos observados exibidos pelos municípios com as métricas de desempenho mais altas e mais baixas fornecem uma base para entender as causas subjacentes da variabilidade pronunciada observada entre essas coortes. Essa análise comparativa é essencial para elucidar os fatores que contribuem para as disparidades nos resultados de desempenho municipal. Além disso, dado que o viés de seleção é uma suposição significativa no modelo de Diferença-em-diferenças, elucidar os determinantes da adoção de políticas pode fortalecer a validade dos efeitos causais estimados. Normalmente, os métodos de pesquisa qualitativa são mais adequados para explorar os processos de tomada de decisão, as informações disponíveis a formuladores(as) de políticas e as fontes de recurso que permitem a adoção da política. Os esforços de pesquisa futuros devem considerar a desagregação dos setores de serviços como um ponto focal de estudo. Essa abordagem é fundamental para elucidar os impactos diferenciados da TZ em diferentes setores de serviços.

Por fim, aprimorar o acesso ao transporte público serve como uma estratégia fundamental para combater a exclusão social, diminuir as emissões de gases de efeito estufa de veículos pessoais e reforçar a mobilidade urbana. Além disso, a alocação de fundos públicos para esse serviço essencial reforça o conceito de direito à cidade. Portanto, pesquisas subsequentes podem fornecer insights valiosos sobre a viabilidade fiscal de tais iniciativas, garantindo sua sustentabilidade e eficácia a longo prazo.




\newpage

# Referências



